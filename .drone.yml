workspace:
    base: /data/service
    path: .

pipeline:
    test:
        image: golang:1.13.6
        commands:
            - pwd
            - go version
            - go test -v
    build:
        image: golang:1.13.6
        environment:
            - GO111MODULE=on
            - GOPROXY=https://goproxy.cn,direct
        commands:
            - go env
            - CGO_ENABLED=0 go build -o api
            - ls -l
    docker:
        image: docker
        commands:
            - sudo service docker restart
            - sudo service docker status
            - docker version
            - docker build -t api:v1 .
            - docker images
    run:
        image: docker
        commands:
            - docker ps
            - docker stop go-api
            - docker ps
            - docker run -d --rm --name go-api -p 8001:8001 api:v1
